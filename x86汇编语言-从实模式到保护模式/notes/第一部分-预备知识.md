### 十六进制到十进制的转换

125H＝1×16^2^＋2×16^1^＋5×16^0^＝293D

### 十进制到十六进制的转换

相应地，要把一个十进制数转换成十六进制数，则可以采取不停地除以 16并取其余数的策略。

![image-20210124193545863](C:\Users\55018\AppData\Roaming\Typora\typora-user-images\image-20210124193545863.png)

293转换得到 125，



## 处理器、内存和指令

Intel 公司生产了世界上第一个处理器 4004。

内存中的每字节都对应着一个地址

![image-20210124193825501](C:\Users\55018\AppData\Roaming\Typora\typora-user-images\image-20210124193825501.png)

​																		图 2-5 内存和内存访问示意图

![image-20210124193942160](C:\Users\55018\AppData\Roaming\Typora\typora-user-images\image-20210124193942160.png)

​																图 2-6 处理器指令在内存中的布局



## 2.5 古老的 Intel 8086 处理器

8086 是 Intel 公司第一款 16位处理器，诞生于 1978 年，

### 2.5.1 8086 的通用寄存器

8086 处理器内部有 8 个 16 位的通用寄存器，分别被命名为 AX、BX、CX、DX、SI、DI、BP、SP。

 AX、BX、CX 和 DX，又各自可以拆分成两个 8 位的寄存器来使用，

总共可以提供 8 个 8 位的寄存器 AH、AL、BH、BL、CH、CL、DH 和 DL。

![image-20210124194133886](C:\Users\55018\AppData\Roaming\Typora\typora-user-images\image-20210124194133886.png)

​																图 2-7 8086 的通用寄存器

### 2.5.2 程序的重定位难题

为了做某件事而编写的指令，它们一起形成了我们平时所说的程序。程序总要操作大量的数据，这些数据也应该集中在一起，位于内存中的某个地方，形成一个段，叫做数据段。

![image-20210124194411028](C:\Users\55018\AppData\Roaming\Typora\typora-user-images\image-20210124194411028.png)

​												图 2-9 在指令中使用绝对内存地址的程序是不可重定位的

### 2.5.3 内存分段机制







# 第 3 章 汇编语言和汇编软件





指令和被指令引用的数据在内存中都是一些或高或低的电平，每一个电平都可以看成是一个二进制位（0 或者 1），8 个二进制位形成一字节。

在很多高级语言中，如果要指示一个数是十六进制数，通常不采用在后面加“H”的做法，而是为它添加一个“0x”前缀。像这样：

跟着字母“B”，以表明它是一个二进制数。



## 3.2 NASM 编译器

NASM 的全称是 Netwide Assembler，它是可免费使用的开源软件

安装后使用Nasm Shell

NASM 需要一系列参数才能正常工作。

-f 参数的作用是指定输出文件的格式（Format）。-f bin 就是要求 NASM 生成的文件只包含“纯二进制”的内容。

-o 参数指定编译后输出（Output）的文件名



## Nasmide

## HexView

等作者用的32位程序还是有些过于out of date,想办法换个开发环境比较来的好。

### 4.1.2 计算机的加电和复位

在处理器众多的引脚中，有一个是 RESET，用于接受复位信号。每当处理器加电，或者RESET 引脚的电平由低变高时，处理器都会执行一个硬件初始化，以及一个可选的内部自测试（Build-in Self-Test，BIST），然后将内部所有寄存器的内容初始到一个预置的状态。

对于 Intel 8086 来说，复位将使代码段寄存器（CS）的内容为 0xFFFF，其他所有寄存器的内容都为 0x0000，包括指令指针寄存器（IP）。

处理器的主要功能是取指令和执行指令，加电或者复位之后，它就会立刻尝试去做这样的工作。不过，在这个时候，内存中还没有任何有意义的指令和数据，它该怎么办呢？
在揭开谜底之前，我们先来看看内存的特点。
为了节约成本，并提高容量和集成度，在内存中，每个比特的存储都是靠一个极其微小的晶体管，外加一个同样极其微小的电容来完成的。可以想象，这样微小的电容，其泄漏电荷的速度当然也非常快。所以，个人计算机中使用的内存需要定期补充电荷，这称为刷新，所以这种存储器也称为动态随机访问存储器（Dynamic Random Access Memory，DRAM）。随机访问的意思是，访问任何一个内存单元的速度和它的位置（地址）无关。内存读写地址为 0x00001 的内存单元，和读写地址为 0xFFFF0 的内存单元，所需要的时间是一样的。在内存刷新期间，处理器将无法访问它。这还不是最麻烦的，最麻烦的是，在它断电之后，所有保存的内容都会统统消失。所以，每当处理器加电之后，它无法从内存中取得任何指令。



### 4.1.3 基本输入输出系统

Intel 8086 可以访问 1MB 的内存空间，地址范围为 0x00000 到 0xFFFFF。出于各方面的考虑，计算机系统的设计者将这 1MB 的内存空间从物理上分为几个部分。

8086 有 20 根地址线，但并非全都用来访问 DRAM，也就是内存条。事实上，这些地址线经过分配，大部分用于访问 DRAM，剩余的部分给了只读存储器 ROM 和外围的板卡，如图 4-2 所示。

![image-20210124195936254](C:\Users\55018\AppData\Roaming\Typora\typora-user-images\image-20210124195936254.png)

​														图 4-2 8086 系统的内存空间分配

与 DRAM 不同，只读存储器（Read Only Memory，ROM）不需要刷新，它的内容是预先写入的，即使掉电也不会消失，但也很难改变。



在以 Intel 8086 为处理器的系统中，ROM 占据着整个内存空间顶端的 64KB，物理地址范围是 0xF0000～0xFFFFF，里面固化了开机时要执行的指令；DRAM 占据着较低端的 640KB，地址范围是 0x00000～0x9FFFF；中间还有一部分，分给了其他外围设备，

因为 8086 加电或者复位时，CS=0xFFFF，IP=0x0000，所以，它取的第一条指令位于物理地址0xFFFF0，正好位于 ROM 中，那里固化了开机时需要执行的指令。

处理器取指令执行的自然顺序是从内存的**低地址往高低地址推进**

如果从 0xFFFF0 开始执行，这个位置离 1MB 内存的顶端（物理地址 0xFFFFF）只有 16 个字节的长度，一旦 IP 寄存器的值超过 0x000F，比如 IP=0x0011，那么，它与 CS 一起形成的物理地址将因为溢出而变成 0x00001，这将回绕到 1MB 内存的最低端。所以，ROM 中位于物理地址 0xFFFF0 的地方，通常是一个跳转指令，它通过改变 CS 和 IP 的内容，使处理器从 ROM 中的较低地址处开始取指令执行。



ROM-BIOS 的容量是有限的，当它完成自己的使命后，最后所要做的，就是从辅助存储设备读取指令数据，然后转到那里开始执行。



## 4.1.4 硬盘及其工作原理

![image-20210124200916556](C:\Users\55018\AppData\Roaming\Typora\typora-user-images\image-20210124200916556.png)

​																		图 4-4 硬盘的结构示意图

硬盘可以只有一个盘片（这称为单碟），也可能有好几个盘片。但无论如何，它们都串在同一个轴上，由电动机带动着一起高速旋转。一般来说，转速可以达到每分钟 3600 转或者 7200 转，有的能达到一万多转，这个参数就是我们常说的“转/分钟”（Round Per Minute，RPM）。



每个盘片都有两个磁头（Head），上面一个，下面一个，所以经常用磁头来指代盘面。磁头都有编号，第 1 个盘片，上面的磁头编号为 0，下面的磁头编号为 1；第 2 个盘片，上面的磁头编号为 2，下面的磁头编号为 3



每个磁头不是单独移动的。相反，它们都通过磁头臂固定在同一个支架上，由步进电动机带动着一起在盘片的中心和边缘之间来回移动。也就是说，它们是同进退的。步进电动机由脉冲驱动，每次可以旋转一个固定的角度，即可以步进一次。



可以想象，当盘片高速旋转时，磁头每步进一次，都会从它所在的位置开始，绕着圆心“画”出一个看不见的圆圈，这就是磁道（Track）。磁道是数据记录的轨迹。因为所有磁头都是联动的，故每个盘面上的同一条磁道又可以形成一个虚拟的圆柱，称为柱面（Cylinder）。



磁道，或者柱面，也要编号。编号是从盘面最边缘的那条磁道开始，向着圆心的方向，从 0 开始编号。

实际上，磁道还不是硬盘数据读写的最小单位，磁道还要进一步划分为扇区（Sector）。磁道很窄，也看不见，但在想象中，它仍呈带状，占有一定的宽度。将它划分许多分段之后，每一部分都呈扇形，这就是扇区的由来。

每条磁道能够划分为几个扇区，取决于磁盘的制造者，但通常为 63 个。而且，每个扇区都有一个编号，与磁头和磁道不同，扇区的编号是从 1 开始的。

扇区与扇区之间以间隙（空白）间隔开来，每个扇区以扇区头开始，然后是 512 个字节的数据区。**扇区头**包含了每个扇区自己的信息，主要有本扇区的磁道号、磁头号和扇区号，用来供硬盘定位机构使用。现代的硬盘还会在扇区头部包括一个指示扇区是否健康的标志，以及用来替换该扇区的扇区地址。用于替换扇区的，是一些保留和隐藏的磁道。

### 4.1.5 一切从主引导扇区开始

当 ROM-BIOS 完成自己的使命之前，最后要做的一件事是从外存储设备读取更多的指令来交给处理器执行。

绝大多数时候，对于 ROM-BIOS 来说，硬盘都是首选的外存储设备。