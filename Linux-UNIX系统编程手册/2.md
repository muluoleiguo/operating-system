**操作系统的核心——内核**



内核：狭义的操作系统——管理和分配计算机资源（CPU、RAM和设备）的核心层软件



Linux内核可执行文件采用 /boot/vmlinuz 或类似，z替换x表示内核是经过压缩的



**内核的职责**

进程调度：Linux属于抢占式多任务操作系统

内存管理：虚拟内存管理机制 优势:1进程与进程之间、进程与内核之间彼此隔离 2只需将进程一部分保持在内存中

提供文件系统：

创建和终止进程：

对设备的访问：为程序访问设备提供了简化版的标准接口，同时仲裁多个进程对每个设备的访问

联网：内核以用户进程的名义收发网络消息 

提供系统调用应用编程接口（API）：进程可利用内核入口点（也称为系统调用）请求内核去执行各种任务。



**内核态（监管态supervisor mode）和用户态**

用户态，CPU只能访问被标记为用户空间的内存



仅当处理器在核心态运行时，才能执行（halt）宕机关闭系统，访问内存管理硬件，设备I/O操作的初始化。

操作系统处于内核空间。



**shell**

用于读取用户输入的命令，并执行相应的程序以响应命令。用户刚登陆系统时，系统创建用于运行shell的进程。



**用户和组**

系统的每个用户都拥有唯一的登录名和对应的整数型UID，系统密码文件/etc/passwd为每个用户都定义有一行纪录，还包含:组ID，用户所属第一个组的整数型组ID ；主目录：用户登录后所居于的初始目录；登陆shell；

用户密码往往单独存于shadow密码文件



用户组都对应这系统组文件/etc/group 中一行记录，包含：组名（唯一）；GID；用户列表



**超级用户**

用户ID 0，登录名 root 可以访问系统中任何文件，发送信号干预系统运行的所有用户进程

## 2.4单根目录层级、目录、链接及文件

内核维护着一套单根目录结构，以放置系统的所有文件。就是名为“/”的根目录



![image-20210119200922510](C:\Users\55018\AppData\Roaming\Typora\typora-user-images\image-20210119200922510.png)



**文件类型**

普通数据文件：普通文件

其他文件类型：设备、管道、套接字、目录、符号链接



**路径和链接**

正常链接（hard link）：

目录：内容采用表格形式，数据项包括文件名以及对相应文件的引用

“文件名+引用”=链接



每个目录至少包含两条记录：.  和 ..   

. 是指向目录自身的链接 .. 是指向父目录的链接 

但对于根目录 .. 指向自身

**符号链接**（soft link）

符号链接给文件起了一个 alternative name 别名

符号链接： 对应目录中内容为“文件名+指针（引用）”的一条记录



**路径名**

绝对路径名：以/开始指明文件相对与根目录的位置

相对路径名：相对于进程当前工作目录的文件位置

**当前工作目录**

略

**文件的所有权和权限**

每个文件都有一个与之相关的用户ID和组ID



## 2.5文件I/O模型

本质 内核只提供一种文件类型：字节流序列



**文件描述符**

计算机网络中有笔记了



## 2.6程序

**过滤器**

从stdin读取输入，转换 ，输出到stdout行为的程序

例如cat  grep tr sort wc sed awk

## 2.7进程

执行程序时，内核会将程序代码载入虚拟内存，为程序变量分配空间，简历bookkeeping 数据结构以记录与进程有关的各种信息（如 进程ID，用户ID 终止状态等）

**进程的内存布局**

逻辑上分为段

* 文本：程序的指令
* 数据： 程序使用的静态变量
* 堆：程序可从该区域动态分配额外内存
* 栈：随函数调用、返回而增加的一片内存，用于为局部变量和函数调用链接信息分配存储空间

**创建进程和执行程序**

fork（），内核通过对父进程的复制创建子进程，子继承父 数据段、栈段、堆段的副本



execve()加载并执行一个全新程序,销毁 文本段、数据段、栈段、堆段并根据新程序代码创建新的

exec打头的函数功能差不多

**进程ID和父进程ID**

父进程标识符（PPID）



**init进程**

系统引导时，内核会创建一个名为init的特殊进程，/sbin/init “所有进程之父” init进程号是1，以root权限运行，所有进程都是init的后代进程创建。只有关闭系统才能终止该进程，init主要任务：创建并监控系统运行所需的一系列进程



**守护进程**

特征：

* 系统引导时启动，直至关闭前一直在
* 在后台运行，无控制终端供其读取或写入数据

例如 syslogd(系统日志) httpd(分发Web页面)



**环境列表**

每个进程都有一份环境列表，在进程用户空间内存中维护

每个元素都由一个名称和相关值组成

例如shell中 变量HOME（明确定义用户登陆目录的路径名）、变量PATH（用户输入命令后，shell查找与之相应程序时所搜索的目录列表）



**资源限制**

软限制（soft limit）:限制了进程可以消耗的资源总量

硬限制（hard limit）: 



## 2.8内存映射

调用系统函数mmap（）的进程，会在其虚拟地址空间中创建一个新的内存映射

映射分为：

* 文件映射
* 匿名映射

## 2.9目标库

静态库：对已编译目标模块的一种结构化整合

共享库：运行时链接



## 2.10 进程间通信及同步

* 信号（signal）
* 管道：| 和FIFO
* 套接字
* 文件锁定
* 消息队列
* 信号量（semaphore）：用来同步进程动作
* 共享内存



## 2.11 signal

信号往往被称作：“软件中断”，进程收到信号意味着时间发生

采用不同整数来标识各种信号类型，并定义宏 SIGXXX



内核向进程发送信号

* CTRL+C
* 进程的子进程之一已经终止
* 由进程设定的定时器（alarm）到期
* 进程尝试访问无效的内存地址

在shell中，可以用kill向进程发送信号

进程行动

* 忽略信号
* 被信号 终止
* 先挂起，之后被专门的信号唤醒

## 2.12 线程

每个线程都会执行相同的程序代码，共享同一数据区域和堆，但每个线程都拥有属于自己的栈：装载本地变量和函数调用链接信息。

